# OpenBSD httpd configuration for happy-api
# Place in /etc/httpd.conf or include from /etc/httpd.conf
#
# NOTE: This server (merah.cassia.ifost.org.au) is behind a CDN.
#       The public-facing hostname is happy.industrial-linguistics.com
#       SSL termination happens at the CDN

# Production configuration (no TLS - CDN handles it)
server "happy.industrial-linguistics.com" {
    log style combined
    directory { auto index }
    listen on $listen_addr port 80
    root "/vhosts/happy.industrial-linguistics.com/htdocs"

    # CGI handler for API endpoints
    # The install script creates symlinks (message, messages, status) â†’ message-api
    # so /v1/message executes /v1/message (symlink to message-api)
    location "/v1/*" {
        fastcgi socket "/run/slowcgi.sock"
        root "/vhosts/happy.industrial-linguistics.com/v1"
    }
}

# Alternative: If you want one binary to handle all /v1/* routes:
# Uncomment this and remove symlinks from install.sh
#
# location "/v1/*" {
#     fastcgi socket "/run/slowcgi.sock"
#     root "/vhosts/happy.industrial-linguistics.com/v1/message-api"
# }

# Additional configuration notes:
#
# 1. Enable slowcgi:
#    # rcctl enable slowcgi
#    # rcctl start slowcgi
#
# 2. Reload httpd after config changes:
#    # rcctl reload httpd
#
# 3. Check configuration syntax:
#    # httpd -n
